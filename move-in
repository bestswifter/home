#!/usr/bin/env zsh

pushd $HOME

  if ! xcode-select --print-path > /dev/null; then
    echo "Requesting install for Command Line Tools, press ENTER to continue."
    /usr/bin/xcode-select --install
    read
  fi

  if git --version | grep -vq license; then
    echo "You need to accept the Xcode license, press ENTER to continue."
    read
    sudo xcodebuild -license
  fi

  if [ -e $HOME/.home ]; then
    pushd $HOME/.home
      git pull
      git submodule update --init --recursive
    popd
  else
    git clone --recursive https://github.com/sj26/home .home
  fi

  for file in .ackrc .bin .gemrc .gitconfig .js .pryrc .railsrc .tmux.conf .vim .zsh
    [ -L $file ] || ln -fs .home/$file
  for file in .config/git/{ignore,attributes}
    mkdir -p "${file%/*}" && [ -L "$file" ] || ln -fs "$HOME/.home/$file" "$HOME/$file"
  for suffix in rc
    [ -L .vim$suffix ] || ln -fs .vim/$suffix .vim$suffix
  for suffix in env profile rc
    [ -L .zsh$suffix ] || ln -fs .zsh/$suffix .zsh$suffix

  [ "$(uname -s)" = "Darwin" ] && .home/move-in-osx

popd
